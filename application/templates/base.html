<!DOCTYPE html>
<html class="no-js">
{% set bootstrap_version = '3.3.2' %}
{% set jquery_version = '2.1.3' %}

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="description" content="梅竹賽五倍祝福">
  <meta name="keywords" content="梅竹, 梅竹賽, 清大, 交大, 清交梅竹賽, 乙未梅竹">
  <meta name="author" content="Salas">
  <meta property="og:url" content="http://appspot" />
  <meta property="og:title" content="梅竹賽五倍祝福" />
  <meta property="og:type" content="website" />
  <meta property="og:description" content="到底行不行啊!官方文件在騙我吧???" />
  <meta property="og:image" content="http://media.urbandictionary.com/image/page/wtf-44339.jpg" />

  <title>梅竹賽五倍祝福</title>
  <link rel="shortcut icon" href="/static/img/favicon.ico">
  <link href="/static/css/materialize.min.css" rel="stylesheet">
  <link href="/static/css/messageline.css" rel="stylesheet">
  <link href="/static/css/demo.css" rel="stylesheet">
</head>
<body>

  {% include 'includes/nav.html' %} {# pull in navbar #}
  <div class="wrap">

    <div class="t-content">
      <section id="home">
        {% include 'main_page.html' %}
      </section>
      <section id="content">
        <div class="row">
          <div class="col offset-m2 offset-l2 s12 m8 l8">
          {% include 'content.html' %}
          </div>
        </div>
      </section>
      <section id="blessing">
        <div class="row">
          <div class="col offset-m2 offset-l2 s12 m8 l8">
          {% include 'includes/flash_message.html' %}
          {% include 'form.html' %}
          {% include 'list_messages.html' %}
          </div>
        </div>
      </section>
    </div><!-- /content -->
  </div><!-- /tabs -->

  {% include 'includes/footer.html' %}

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/{{ jquery_version }}/jquery.min.js"></script>
  <script src="/static/js/materialize.min.js"></script>
  {% block tail_script %}
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId: '372111882968567',
        version: 'v2.2',
        cookie: true,
        status: true,
        xfbml: true
      });
    };
    (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/zh_TW/all.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
  </script>
  <script>
    $(function(){
      $('#go4nthu').click(function(ev) {
        ev.preventDefault();
        $('ul.tabs').tabs('select_tab', 'blessing');
      });
      $('#go4nctu').click(function(ev) {
        ev.preventDefault();
        $('ul.tabs').tabs('select_tab', 'blessing');
      });
      $('#new-message-form').submit(function(){
        $.post($(this).attr('action'), $(this).serialize(), function(d) {
          var b = document.createElement('button');
          b.innerHTML = '分享';
          b.className = 'btn waves-effect waves-light right';
          b.onclick = function() {
            FB.ui({
              method: 'feed',
              link: window.location.href,
            },
            function(response) {
              if (response && response.post_id) {
                $.post("{{ url_for('update_message') }}", {'c':response.post_id},
                  function(dd) {
                  console.log(dd);}
                );
              }
            });
            location.reload();
          }
          $('#somewhere').append(b);
          $('#new-message-form')[0].remove();
        }, 'json');
        return false;
      });
    });

  </script>
  {% endblock %}
  {{ profiler_includes|safe }}
</body>
</html>
