<div class="row">
  <div class="col s12 offset-m2 m8 card center-align">
    <form id="more-message-form" method="post" action="{{ url_for('more_message') }}" accept-charset="utf-8">
      {{ form.hidden_tag() }}
      <div class="card-content"><span class="card-title pink-text text-accent-4">想看看哪個系？</span></div>

      <div class="row">
        <div class="input-field col s6">
          <select class="_browser-default" name="department">
            <option value="" disabled selected>系別</option>
            {% for subfield in form.department %}
            {{ subfield }}
            {% endfor %}
          </select>
        </div>
        <button class="btn waves-effect waves-light" type="submit" name="action">送出<i class="mdi-content-send right"></i></button>
      </div>
    </form>



  </div>
  <div class="col s12 offset-m2 m8">
    <ul class="collapsible" data-collapsible="accordion">
      <li class="collection-header" style="">
        <div id="n" class="collapsible-header">查詢結果</div>
        <div class="collapsible-body" style="background:#ddd">
          <table><tbody id="column"></tbody></table>
        </div>
      </li>
    </ul>
  </div>
</div>

<script>
  $(document).ready(function(){
    $('.collapsible').collapsible({
      accordion : false
    });
    $('#more-message-form').submit(function(){
      $.post($(this).attr('action'), $(this).serialize(), function(d) {
        d = d.messages;
        $('#n').text(d[0].department);
        $('#column').html('');
        for (var i = d.length - 1; i >= 0; i--) {
          var node = document.createElement('tr'),
              j = document.createElement('td'),
              k = document.createElement('td'),
              l = document.createElement('td');
          node.className = 'row', j.className='col s8', k.className='col s2'; l.className='col s1'
          j.innerHTML = d[i].description;
          k.innerHTML = d[i].department;
          l.innerHTML = d[i].grade;
          node.appendChild(j);
          node.appendChild(k);
          node.appendChild(l);
          $('#column').append(node);
        };
      }, 'json');
      return false;
    });
    $('select').material_select();
  });
</script>
